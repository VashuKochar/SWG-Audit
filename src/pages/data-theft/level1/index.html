<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Theft – File upload – SWG Audit</title>
  <meta name="description" content="Data theft simulation: file upload types. Upload allowed = perimeter may have failed. Blocked = passed. Max 1 KB.">
  <meta name="keywords" content="SWG Audit, data theft test, file upload, perimeter security">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="icon" type="image/x-icon" href="/icons/favicon.ico">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
</head>
<body>
  {{> header }}


  <main>
    <div class="page-hero">
      <div class="page-hero-inner">
        <h2 id="data-theft-l1-heading" class="landing-hero-headline">File upload types</h2>
      </div>
    </div>
    <div class="section-strip">
      <section class="section" aria-labelledby="data-theft-l1-heading">
    <p>Upload allowed = perimeter may have failed. Blocked = passed. Use a sample file or upload your own (max 1 KB). File will be deleted from the server after 10 minutes.</p>
    <form id="upload-form">
      <div id="file-choice" class="data-theft-choice">
        <p><strong>Choose file</strong></p>
        <p class="data-theft-samples">
          <span class="data-theft-sample-label">Use sample:</span>
          <button type="button" id="sample-plain" aria-label="Use sample plain text file">Plain text</button>
        </p>
        <p class="data-theft-upload-label">Or upload your own file (max 1 KB)</p>
        <div id="upload-area" class="data-theft-upload-area" role="button" tabindex="0" aria-label="Drag and drop or click to select a file">
          <span class="data-theft-upload-text">Drag and drop or click to select a file</span>
          <input type="file" id="file" name="file" accept="*" class="data-theft-file-input">
        </div>
      </div>
      <div id="current-file-block" class="data-theft-current" hidden>
        <p><strong>Current file:</strong> <span id="current-file-name" aria-live="polite"></span><span id="current-file-size" class="data-theft-filesize" aria-live="polite"></span></p>
        <p>
          <label for="file-name">File name (optional)</label><br>
          <input type="text" id="file-name" name="file-name" aria-label="File name for upload">
        </p>
        <p>
          <button type="button" id="change-file" aria-label="Choose a different file or sample">Change file</button>
          <button type="submit">Upload file</button>
        </p>
      </div>
    </form>
    <div id="upload-result-block" class="data-theft-result" hidden>
      <h4 id="upload-result-heading"></h4>
      <p id="upload-result-message"></p>
      <p id="upload-result-url-wrap" class="data-theft-result-url" hidden></p>
      <p id="upload-result-delete-msg" class="data-theft-delete-msg" hidden>File will be deleted from the server in <span id="upload-timer" aria-live="polite">10:00</span></p>
      <p><button type="button" id="reset-test-btn" class="button-secondary">Reset test</button></p>
    </div>
    <p><a href="/data-theft/level2/">DLP signatures</a> · <a href="/data-theft/level3/">DNS exfil</a></p>
      </section>
    </div>
  </main>

  {{> footer }}


  <script>
    (function () {
      var SAMPLES = { plain: { label: 'Plain text', filename: 'sample-plain.txt', content: 'Sample plain text for Level 1 file upload test.' } };
      var form = document.getElementById('upload-form');
      var fileChoice = document.getElementById('file-choice');
      var currentFileBlock = document.getElementById('current-file-block');
      var currentFileNameEl = document.getElementById('current-file-name');
      var currentFileSizeEl = document.getElementById('current-file-size');
      var uploadArea = document.getElementById('upload-area');
      var fileInput = document.getElementById('file');
      var fileNameInput = document.getElementById('file-name');
      var changeFileBtn = document.getElementById('change-file');
      var resultBlock = document.getElementById('upload-result-block');
      var resultHeading = document.getElementById('upload-result-heading');
      var resultMessage = document.getElementById('upload-result-message');
      var resultUrlWrap = document.getElementById('upload-result-url-wrap');
      var resultDeleteMsg = document.getElementById('upload-result-delete-msg');
      var uploadTimer = document.getElementById('upload-timer');
      var resetTestBtn = document.getElementById('reset-test-btn');
      var currentFile = null;
      var countdownInterval = null;
      function formatBytes(bytes) {
        if (bytes === 0) return '0 B';
        var k = 1024, sizes = ['B', 'KB', 'MB'];
        var i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }
      function setCurrentSample(id) {
        var sample = SAMPLES[id];
        if (!sample) return;
        currentFile = { type: 'sample', id: id };
        fileChoice.hidden = true;
        currentFileBlock.hidden = false;
        currentFileNameEl.textContent = sample.label;
        currentFileSizeEl.textContent = '';
        fileNameInput.value = sample.filename;
      }
      function setCurrentOwnFile(file) {
        currentFile = { type: 'own', file: file };
        fileChoice.hidden = true;
        currentFileBlock.hidden = false;
        currentFileNameEl.textContent = file.name;
        currentFileSizeEl.textContent = ' (' + formatBytes(file.size) + ')';
        fileNameInput.value = file.name;
      }
      function clearCurrentFile() {
        currentFile = null;
        fileInput.value = '';
        fileNameInput.value = '';
        fileChoice.hidden = false;
        currentFileBlock.hidden = true;
      }
      function showResult(options) {
        var isFailure = options.isFailure, message = options.message, fileUrl = options.fileUrl || '', showTimer = options.showTimer === true;
        form.hidden = true;
        resultBlock.hidden = false;
        resultHeading.textContent = isFailure ? 'Your Perimeter Security Failed' : 'Upload blocked or failed';
        resultHeading.className = isFailure ? 'error' : 'success';
        resultMessage.textContent = message;
        resultMessage.className = isFailure ? 'error' : 'success';
        resultUrlWrap.hidden = !fileUrl;
        if (fileUrl) resultUrlWrap.innerHTML = 'File successfully uploaded. <a href="' + fileUrl + '" target="_blank" rel="noopener">Visit file URL</a>';
        resultDeleteMsg.hidden = !showTimer;
        if (showTimer) {
          var timeLeft = 600;
          if (countdownInterval) clearInterval(countdownInterval);
          countdownInterval = setInterval(function () {
            var m = Math.floor(timeLeft / 60), s = timeLeft % 60;
            uploadTimer.textContent = m + ':' + (s < 10 ? '0' : '') + s;
            if (timeLeft <= 0) { clearInterval(countdownInterval); countdownInterval = null; }
            timeLeft--;
          }, 1000);
        } else if (countdownInterval) { clearInterval(countdownInterval); countdownInterval = null; }
      }
      function resetTest() {
        if (countdownInterval) { clearInterval(countdownInterval); countdownInterval = null; }
        resultBlock.hidden = true;
        form.hidden = false;
        clearCurrentFile();
      }
      document.getElementById('sample-plain').addEventListener('click', function () { setCurrentSample('plain'); });
      uploadArea.addEventListener('click', function (e) { if (e.target !== fileInput) fileInput.click(); });
      uploadArea.addEventListener('keydown', function (e) { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); fileInput.click(); } });
      uploadArea.addEventListener('dragover', function (e) { e.preventDefault(); uploadArea.classList.add('data-theft-dragover'); });
      uploadArea.addEventListener('dragleave', function () { uploadArea.classList.remove('data-theft-dragover'); });
      uploadArea.addEventListener('drop', function (e) {
        e.preventDefault();
        uploadArea.classList.remove('data-theft-dragover');
        var files = e.dataTransfer && e.dataTransfer.files;
        if (files && files.length) {
          var file = files[0];
          if (file.size > 1024) { resultBlock.hidden = false; form.hidden = true; showResult({ isFailure: false, message: 'File size exceeds 1 KB. Choose a smaller file.', showTimer: false }); return; }
          fileInput.files = files;
          setCurrentOwnFile(file);
        }
      });
      fileInput.addEventListener('change', function () {
        var file = fileInput.files && fileInput.files[0];
        if (file) {
          if (file.size > 1024) { resultBlock.hidden = false; form.hidden = true; showResult({ isFailure: false, message: 'File size exceeds 1 KB. Choose a smaller file.', showTimer: false }); return; }
          setCurrentOwnFile(file);
        }
      });
      changeFileBtn.addEventListener('click', clearCurrentFile);
      resetTestBtn.addEventListener('click', resetTest);
      form.addEventListener('submit', function (e) {
        e.preventDefault();
        if (!currentFile) { showResult({ isFailure: false, message: 'Choose a sample or upload a file.', showTimer: false }); form.hidden = true; resultBlock.hidden = false; return; }
        var displayName = (fileNameInput.value && fileNameInput.value.trim()) || null;
        var fd = new FormData();
        var fileToSend;
        if (currentFile.type === 'sample') {
          var sample = SAMPLES[currentFile.id];
          fileToSend = new File([sample.content], displayName || sample.filename, { type: 'text/plain' });
        } else {
          var f = currentFile.file;
          fileToSend = displayName ? new File([f], displayName, { type: f.type }) : f;
        }
        fd.append('file', fileToSend);
        fetch('/data-theft/upload', { method: 'POST', body: fd })
          .then(function (r) {
            return r.json().then(function (data) {
              if (r.ok) {
                var fullUrl = data.url ? (window.location.origin + data.url) : '';
                showResult({ isFailure: true, message: 'File upload to the server should have been blocked. Review SWG or DLP logs for this upload.', fileUrl: fullUrl, showTimer: true });
              } else {
                var msg = data.error || 'Perimeter may have passed.';
                if (r.status === 413 || (data.error && data.error.indexOf('size') !== -1)) msg = 'File too large. Maximum size is 1 KB.';
                else if (data.error && data.error.indexOf('Max uploads') !== -1) msg = 'Upload limit reached for this session (max 5). Go to the home page and verify again to start a new session.';
                showResult({ isFailure: false, message: msg, showTimer: false });
              }
            }, function () {
              if (r.status === 413) showResult({ isFailure: false, message: 'File too large. Maximum size is 1 KB.', showTimer: false });
              else showResult({ isFailure: false, message: 'Request failed or blocked. Perimeter may have passed.', showTimer: false });
            });
          })
          .catch(function () { showResult({ isFailure: false, message: 'Request failed or blocked. Perimeter may have passed.', showTimer: false }); });
      });
    })();
  </script>
</body>
</html>
