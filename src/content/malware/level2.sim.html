<div class="sim-section">
  <h3 id="sim-content-heading">Chunked EICAR Assembly Test</h3>
  <p>This simulation downloads EICAR in two separate HTTP requests and assembles them in your browser. This tests whether your SWG can detect malware that's delivered in fragments.</p>
  <p><strong>How it works:</strong></p>
  <ol>
    <li>Request 1 fetches the first 34 bytes of EICAR</li>
    <li>Request 2 fetches the remaining 34 bytes</li>
    <li>JavaScript assembles the full file in memory</li>
    <li>Assembled file is downloaded</li>
  </ol>
  <p><button type="button" id="chunked-download" class="button-cta">Start Chunked Download Test</button></p>
  
  <!-- Result banners -->
  <div id="result-pass" class="result-banner result-banner-pass">
    <div class="result-banner-header">
      <span class="result-banner-icon">‚úÖ</span>
      <span>PASS ‚Äî Chunks Blocked</span>
    </div>
    <div class="result-banner-body">
      <p><strong>What happened:</strong> Your SWG blocked one or more chunk requests before they could be assembled.</p>
      <p><strong>Why this matters:</strong> This demonstrates advanced malware detection:</p>
      <ul>
        <li>Content reassembly inspection</li>
        <li>Pattern matching across multiple requests</li>
        <li>Stateful analysis (tracking related connections)</li>
      </ul>
      <p>Attackers often split malware into fragments to evade signature-based detection. Your perimeter successfully detected the reassembled threat.</p>
    </div>
  </div>
  
  <div id="result-fail" class="result-banner result-banner-fail">
    <div class="result-banner-header">
      <span class="result-banner-icon">‚ùå</span>
      <span>FAIL ‚Äî Chunked Download Succeeded</span>
    </div>
    <div class="result-banner-body">
      <p><strong>What happened:</strong> Both chunks downloaded successfully and were assembled into the complete EICAR file.</p>
      <p><strong>Why this is a problem:</strong> Your perimeter only inspected individual HTTP responses, not the reassembled content. This technique is used by:</p>
      <ul>
        <li><strong>Malware loaders:</strong> Download components separately and assemble on the endpoint</li>
        <li><strong>Ransomware:</strong> Split encrypted payloads across multiple requests</li>
        <li><strong>Data exfiltration:</strong> Chunk sensitive data to evade DLP</li>
      </ul>
      <p><strong>What to check:</strong></p>
      <ul>
        <li>Is stateful inspection enabled on your SWG?</li>
        <li>Does your SWG track and reassemble fragmented downloads?</li>
        <li>Is heuristic/behavioral analysis active?</li>
      </ul>
    </div>
  </div>
</div>

<!-- Explainer: What this simulation tests -->
<div class="explainer-box">
  <h4>üí° What This Simulation Tests</h4>
  <p>This level validates <strong>content reassembly and stateful inspection</strong> ‚Äî detecting threats split across multiple requests.</p>
  <p><strong>The fragmentation evasion technique:</strong></p>
  <p>Attackers split malware into harmless-looking fragments. Each fragment passes signature-based scanning because it doesn't contain complete malware signatures. Only when reassembled does the threat become active.</p>
  <p>A properly configured SWG should:</p>
  <ul>
    <li>Track related HTTP requests (same session, same destination)</li>
    <li>Reassemble fragmented content before scanning</li>
    <li>Apply signatures to reassembled payloads</li>
    <li>Use behavioral analysis to detect suspicious assembly patterns</li>
  </ul>
  <p><strong>Real-world example:</strong> Modern ransomware often downloads an initial loader (< 10KB, no obvious malware signature), which then fetches encrypted components from multiple CDN endpoints. Only when assembled and decrypted does the actual ransomware execute.</p>
  <p><strong>Attack Vector:</strong> Fragmentation bypasses simple signature matching. Requires stateful inspection and content reassembly to detect.</p>
</div>

<!-- Recommendation box -->
<div class="recommendation-box">
  <h4>üõ°Ô∏è Best Practice Recommendations</h4>
  <p>To ensure your SWG effectively blocks fragmented malware delivery:</p>
  <ul>
    <li><strong>Enable stateful inspection</strong> ‚Äî track connection state, not just individual packets</li>
    <li><strong>Configure content reassembly</strong> ‚Äî most modern SWGs support this, but it may need explicit enablement</li>
    <li><strong>Use behavioral analysis</strong> ‚Äî detect patterns like "multiple small downloads from same source" + "JavaScript assembly"</li>
    <li><strong>Enable HTTP/2 stream inspection</strong> ‚Äî modern protocols allow multiplexed streams</li>
    <li><strong>Inspect WebSocket traffic</strong> ‚Äî attackers use WebSockets for command-and-control</li>
    <li><strong>Layer with endpoint detection (EDR)</strong> ‚Äî catches post-assembly execution</li>
    <li><strong>Monitor for unusual download patterns</strong> ‚Äî multiple small files from new domains</li>
  </ul>
  <p><strong>Performance note:</strong> Stateful inspection and reassembly increase processing overhead. Size your SWG hardware/VM appropriately for your traffic volume.</p>
</div>
