// Load shared result helper
(function() {
  var script = document.createElement('script');
  script.src = '/js/shared/result-helper.js';
  script.onload = function() {
    setupDownloadTest();
  };
  document.head.appendChild(script);
})();

function setupDownloadTest() {
  var plainLink = document.getElementById('download-plain');
  var zipLink = document.getElementById('download-zip');
  
  // Note: We can't reliably detect if download succeeded or was blocked via JS
  // Best we can do is show instructions after click
  
  function handleDownloadAttempt(e) {
    // Give time for browser to attempt download
    setTimeout(function() {
      // If user sees this, download likely succeeded (FAIL)
      // If blocked, they won't even get here or will see block page
      var instruction = document.createElement('div');
      instruction.className = 'explainer-box';
      instruction.style.marginTop = 'var(--space-4)';
      instruction.innerHTML = '<h4>Did the download complete?</h4>' +
        '<p><strong>If YES (file downloaded):</strong> Your perimeter failed to block EICAR.</p>' +
        '<p><strong>If NO (blocked or warning shown):</strong> Your perimeter passed.</p>' +
        '<p><button onclick="showResult(\'pass\')" class="button">Report: Blocked (PASS)</button> ' +
        '<button onclick="showResult(\'fail\')" class="button-secondary">Report: Downloaded (FAIL)</button></p>';
      
      // Insert after sim-section if not already present
      if (!document.querySelector('.explainer-box h4').textContent.includes('Did the download')) {
        document.querySelector('.sim-section').after(instruction);
      }
    }, 500);
  }
  
  if (plainLink) plainLink.addEventListener('click', handleDownloadAttempt);
  if (zipLink) zipLink.addEventListener('click', handleDownloadAttempt);
}
